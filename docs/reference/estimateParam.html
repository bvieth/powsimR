<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimate simulation parameters — estimateParam • powsimR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimate simulation parameters — estimateParam" />
<meta property="og:description" content="This function estimates and returns parameters needed for power simulations.
The user needs to choose the following options at least: specify a gene expression matrix; the type of RNA-seq experiment, i.e. bulk or single cell; the recommended distribution is negative binomial (NB) except for single-cell full-length Smart-seq2 read data where we recommend zero-inflated NB (ZINB); the preferred normalisation method, we recommend scran for single cell and TMM or MR for bulk.
The other parameters are optional (additional data) or have preset values (gene and sample filtering). Please consult the detailed arguments description." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">powsimR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/powsimR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bvieth/powsimR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate simulation parameters</h1>
    <small class="dont-index">Source: <a href='https://github.com/bvieth/powsimR/blob/master/R/Estimate.R'><code>R/Estimate.R</code></a></small>
    <div class="hidden name"><code>estimateParam.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function estimates and returns parameters needed for power simulations.<br />
The user needs to choose the following options at least: specify a gene expression matrix; the type of RNA-seq experiment, i.e. bulk or single cell; the recommended distribution is negative binomial (NB) except for single-cell full-length Smart-seq2 read data where we recommend zero-inflated NB (ZINB); the preferred normalisation method, we recommend scran for single cell and TMM or MR for bulk.<br />
The other parameters are optional (additional data) or have preset values (gene and sample filtering). Please consult the detailed arguments description.</p>
    </div>

    <pre class="usage"><span class='fu'>estimateParam</span>(<span class='no'>countData</span>,
<span class='kw'>readData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
<span class='kw'>batchData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
<span class='kw'>spikeData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
<span class='kw'>spikeInfo</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
<span class='kw'>Lengths</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
<span class='kw'>MeanFragLengths</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
<span class='kw'>RNAseq</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'bulk'</span>, <span class='st'>'singlecell'</span>),
<span class='kw'>Protocol</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'UMI'</span>, <span class='st'>'Read'</span>),
<span class='kw'>Distribution</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'NB'</span>, <span class='st'>'ZINB'</span>),
<span class='kw'>Normalisation</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"TMM"</span>, <span class='st'>"MR"</span>, <span class='st'>"PosCounts"</span>, <span class='st'>"UQ"</span>,
<span class='st'>"scran"</span>, <span class='st'>"Linnorm"</span>, <span class='st'>"sctransform"</span>,
<span class='st'>"SCnorm"</span>, <span class='st'>"Census"</span>, <span class='st'>"depth"</span>, <span class='st'>"none"</span>),
<span class='kw'>GeneFilter</span> <span class='kw'>=</span> <span class='fl'>0.05</span>,
<span class='kw'>SampleFilter</span> <span class='kw'>=</span> <span class='fl'>5</span>,
<span class='kw'>sigma</span> <span class='kw'>=</span> <span class='fl'>1.96</span>,
<span class='kw'>NCores</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
<span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>countData</th>
      <td><p>is a (UMI) count <code>matrix</code> of gene expression.
Rows correspond to genes, columns to samples.
The gene names should be given as <code>rownames</code> without "_" in the names.
The samples names should be given as <code>colnames</code>.
The count matrix should only contain the expression of one group, e.g. wildtype / untreated control / one cell type population.</p></td>
    </tr>
    <tr>
      <th>readData</th>
      <td><p>is a the matching read count <code>matrix</code> of gene expression if <code>countData</code> is UMI
and the same formatting should be applied. Default is <code>NULL</code> and
users only need to supply the read count matrix if they plan to apply downsampling of UMI counts for simulations, see <code><a href='Setup.html'>Setup</a></code>.</p></td>
    </tr>
    <tr>
      <th>batchData</th>
      <td><p>is a <code>data.frame</code> for batch annotation.
Rows correspond to samples. The first column should contain the batches, e.g. 'a', 'b', 'c', etc.</p></td>
    </tr>
    <tr>
      <th>spikeData</th>
      <td><p>is a count <code>matrix</code>.
Rows correspond to spike-ins, columns to samples.
The order of columns should be the same as in the <code>countData</code>.
This is only needed for spike-in aware normalisation methods ('MR', 'Linnorm', 'scran', 'SCnorm', 'bayNorm', 'Census'), see Details.</p></td>
    </tr>
    <tr>
      <th>spikeInfo</th>
      <td><p>is a molecule count <code>matrix</code> of spike-ins.
Rows correspond to spike-ins. The order of rows should be the same as in the <code>spikeData</code>.
The column names should be 'SpikeID' and 'SpikeInput' for molecule counts of spike-ins.
This is only needed for spike-in aware normalisation methods (), see Details.</p></td>
    </tr>
    <tr>
      <th>Lengths</th>
      <td><p>is a numeric vector of transcript lengths with the same length and order as the rows in countData.
This variable is only needed for internal gene length corrections (TPM), see Details.</p></td>
    </tr>
    <tr>
      <th>MeanFragLengths</th>
      <td><p>is a numeric vector of mean fragment lengths with the same length as columns in countData.
This variable is only needed for internal gene length corrections (TPM), see Details.</p></td>
    </tr>
    <tr>
      <th>RNAseq</th>
      <td><p>is a character value: "bulk" or "singlecell".</p></td>
    </tr>
    <tr>
      <th>Protocol</th>
      <td><p>is a character value defining the type of counts given in <code>countData</code>.
Options are "UMI" (e.g. 10X Genomics, CEL-seq2) or "Read" (e.g. Smart-seq2).</p></td>
    </tr>
    <tr>
      <th>Distribution</th>
      <td><p>is a character value: "NB" for negative binomial or "ZINB" for zero-inflated negative binomial distribution fitting.</p></td>
    </tr>
    <tr>
      <th>Normalisation</th>
      <td><p>is a character value: 'TMM', 'MR', 'PosCounts', 'UQ', 'scran', 'Linnorm',
'SCnorm', 'Census', 'depth', 'none'.
For more information, please consult the Details section.</p></td>
    </tr>
    <tr>
      <th>GeneFilter</th>
      <td><p>is a numeric vector indicating the minimal proportion of nonzero expression values
for a gene across all samples to be considered expressed and used for normalisation and parameter estimation.
The default is <code>0.05</code>, i.e. at least 5% of the expression values per gene need to be nonzero.</p></td>
    </tr>
    <tr>
      <th>SampleFilter</th>
      <td><p>is a numeric vector indicating the minimal number of MADs (median absolute deviation)
away from the median number of features detected as well as sequencing depth across all samples
so that outlying samples are removed prior to normalisation and parameter estimation.
The default is <code>5</code>, i.e. at least 5 MADs away from the median.
Choose higher values if you want to filter out less samples.
This parameter is particularly important for single cells to ensure reliable parameter estimation.
For more information, please consult <code><a href='https://rdrr.io/pkg/scater/man/isOutlier.html'>isOutlier</a></code>.</p></td>
    </tr>
    <tr>
      <th>sigma</th>
      <td><p>The variability band width for mean-dispersion loess fit defining the prediction interval for read count simulation. Default is 1.96, i.e. 95% interval. For more information see <code><a href='https://mclust-org.github.io/msir/reference/loess.sd.html'>loess.sd</a></code>.</p></td>
    </tr>
    <tr>
      <th>NCores</th>
      <td><p>The number of cores for normalisation method SCnorm and Census.
The default <code>NULL</code> means 1 core.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical value to indicate whether to print function information.
Default is <code>TRUE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>List object with the following entries:</p>
<dt>Parameters</dt><dd><p>A list object containing the estimated moments for the full, dropped out genes, dropped out samples and filtered normalized count matrix. For more information please consult the details section and the plot made with <code><a href='plotParam.html'>plotParam</a></code>.</p></dd>
<dt>Fit</dt><dd><p>A list object containing the fitting results of the mean-dispersion and mean-dropout relation as well as the estimated parameter data used for the fits. For more information please consult the details section and the plot made with <code><a href='plotParam.html'>plotParam</a></code>.</p></dd>
<dt>totalS,totalG</dt><dd><p>Number of samples and genes provided with at least one read count.</p></dd>
<dt>DropOuts</dt><dd><p>List object containing logical vectors for gene and sample dropouts after applying gene frequency and sample outlier filtering.</p></dd>
<dt>sf</dt><dd><p>The estimated library size factor per sample.</p></dd>
<dt>Lengths -..- SampleFilter</dt><dd><p>The chosen parameters settings.</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><strong>Normalisation Methods</strong></p><dl'>
<dt>TMM, UQ</dt><dd><p>employ the edgeR style normalization of weighted trimmed mean of M-values and upperquartile
as implemented in <code><a href='https://rdrr.io/pkg/edgeR/man/calcNormFactors.html'>calcNormFactors</a></code>, respectively.</p></dd>
<dt>MR, PosCounts</dt><dd><p>employ the DESeq2 style normalization of median ratio method and a modified geometric mean method
as implemented in <code><a href='https://rdrr.io/pkg/DESeq2/man/estimateSizeFactors.html'>estimateSizeFactors</a></code>, respectively.</p></dd>
<dt>scran, SCnorm</dt><dd><p>apply the deconvolution and quantile regression normalization methods developed for sparse RNA-seq data
as implemented in <code><a href='https://rdrr.io/pkg/scran/man/computeSumFactors.html'>calculateSumFactors</a></code> and <code><a href='https://rdrr.io/pkg/SCnorm/man/SCnorm.html'>SCnorm</a></code>, respectively. Spike-ins can also be supplied for both methods via <code>spikeData</code>. Note, however that this means for scran that the normalisation as implemented in <code><a href='https://rdrr.io/pkg/scran/man/computeSpikeFactors.html'>computeSpikeFactors</a></code> is also applied to genes (<code>general.use=TRUE</code>).</p></dd>
<dt>Linnorm</dt><dd><p>apply the normalization method for sparse RNA-seq data
as implemented in <code><a href='https://rdrr.io/pkg/Linnorm/man/Linnorm.Norm.html'>Linnorm.Norm</a></code>.
For <code>Linnorm</code>, the user can also supply <code>spikeData</code>.</p></dd>
<dt>sctransform</dt><dd><p>apply the normalization method developed for single-cell
UMI RNA-seq data as implemented in <code><a href='https://rdrr.io/pkg/sctransform/man/vst.html'>vst</a></code>.</p></dd>
<dt>Census</dt><dd><p>converts relative measures of TPM/FPKM values into mRNAs per cell (RPC) without the need of spike-in standards.
Census at least needs <code>Lengths</code> for single-end data and preferably <code>MeanFragLengths</code> for paired-end data.
The authors state that Census should not be used for UMI data.</p></dd>
<dt>depth</dt><dd><p>Sequencing depth normalisation.</p></dd>
<dt>none</dt><dd><p>No normalisation is applied. This approach can be used for prenormalized expression estimates, e.g. cufflinks, RSEM or salmon.</p></dd>

</dl>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># Single Cells</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"SmartSeq2_Gene_Read_Counts"</span>)
<span class='no'>Batches</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='kw'>Batch</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/strsplit.html'>strsplit</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>SmartSeq2_Gene_Read_Counts</span>), <span class='st'>"_"</span>), <span class='st'>"[["</span>, <span class='fl'>1</span>),
                      <span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>SmartSeq2_Gene_Read_Counts</span>))
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"GeneLengths_mm10"</span>)
<span class='no'>estparam</span> <span class='kw'>&lt;-</span> <span class='fu'>estimateParam</span>(<span class='kw'>countData</span> <span class='kw'>=</span> <span class='no'>SmartSeq2_Gene_Read_Counts</span>,
                          <span class='kw'>readData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                          <span class='kw'>batchData</span> <span class='kw'>=</span> <span class='no'>Batches</span>,
                          <span class='kw'>spikeData</span> <span class='kw'>=</span> <span class='no'>SmartSeq2_SpikeIns_Read_Counts</span>,
                          <span class='kw'>spikeInfo</span> <span class='kw'>=</span> <span class='no'>SmartSeq2_SpikeInfo</span>,
                          <span class='kw'>Lengths</span> <span class='kw'>=</span> <span class='no'>GeneLengths</span>, <span class='kw'>MeanFragLengths</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                          <span class='kw'>RNAseq</span> <span class='kw'>=</span> <span class='st'>'singlecell'</span>, <span class='kw'>Protocol</span> <span class='kw'>=</span> <span class='st'>'Read'</span>,
                          <span class='kw'>Distribution</span> <span class='kw'>=</span> <span class='st'>'ZINB'</span>, <span class='kw'>Normalisation</span> <span class='kw'>=</span> <span class='st'>"scran"</span>,
                          <span class='kw'>GeneFilter</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>SampleFilter</span> <span class='kw'>=</span> <span class='fl'>3</span>,
                          <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='fl'>1.96</span>, <span class='kw'>NCores</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Bulk</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"Bulk_Read_Counts"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"GeneLengths_hg19"</span>)
<span class='no'>estparam</span> <span class='kw'>&lt;-</span> <span class='fu'>estimateParam</span>(<span class='kw'>countData</span> <span class='kw'>=</span> <span class='no'>Bulk_Read_Counts</span>,
                          <span class='kw'>readData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                          <span class='kw'>batchData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                          <span class='kw'>spikeData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                          <span class='kw'>spikeInfo</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                         <span class='kw'>Lengths</span> <span class='kw'>=</span> <span class='no'>GeneLengths_hg19</span>,
                          <span class='kw'>MeanFragLengths</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                          <span class='kw'>RNAseq</span> <span class='kw'>=</span> <span class='st'>'bulk'</span>, <span class='kw'>Protocol</span> <span class='kw'>=</span> <span class='st'>'Read'</span>,
                          <span class='kw'>Distribution</span> <span class='kw'>=</span> <span class='st'>'NB'</span>, <span class='kw'>Normalisation</span> <span class='kw'>=</span> <span class='st'>"MR"</span>,
                          <span class='kw'>GeneFilter</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>SampleFilter</span> <span class='kw'>=</span> <span class='fl'>3</span>,
                          <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='fl'>1.96</span>, <span class='kw'>NCores</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># plot the results of estimation</span>
<span class='fu'><a href='plotParam.html'>plotParam</a></span>(<span class='no'>estparam</span>, <span class='kw'>Annot</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Beate Vieth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


