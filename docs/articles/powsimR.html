<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>powsimR • powsimR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="powsimR">
<meta property="og:description" content="powsimR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">powsimR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/powsimR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bvieth/powsimR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="powsimR_files/header-attrs-2.5/header-attrs.js"></script><link href="powsimR_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="powsimR_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>powsimR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bvieth/powsimR/blob/master/vignettes/powsimR.Rmd"><code>vignettes/powsimR.Rmd</code></a></small>
      <div class="hidden name"><code>powsimR.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h1>
<p>This vignette describes the R package <code>powsimR</code> <span class="citation">(<a href="#ref-Vieth2017-lh" role="doc-biblioref">Vieth et al. 2017</a>)</span>. It aims to be at once a demonstration of its features and a guide to its usage. Statistical power analysis is essential to optimize the design of RNA-seq experiments and to assess and compare the power to detect differentially expressed genes in RNA-seq data. <code>powsimR</code> is a flexible tool to simulate and evaluate differential expression from bulk and especially single-cell RNA-seq data making it suitable for a priori and posterior power analyses.</p>
<p>For our count simulations, we (1) reliably model the mean, dispersion and dropout distributions as well as the relationship between those factors from the data. (2) Simulate counts from the empirical mean-variance and dropout relations, while offering flexible choices of the number of differentially expressed genes, effect sizes, DE testing and normalisation method. (3) Finally, we evaluate the power over various sample sizes and visualise the results with error rates plots.</p>
<p><strong>Note:</strong> if you use powsimR in published research, please cite:</p>
<blockquote>
<p>Vieth, B., Ziegenhain, C., Parekh, S., Enard, W. and Hellmann, I. (2017) powsimR: Power Analysis for Bulk and Single Cell RNA-Seq Experiments. <em>Bioinformatics</em>, <strong>33(21)</strong>:3486-88. <a href="http://dx.doi.org/10.1093/bioinformatics/btx435">10.1093/bioinformatics/btx435</a></p>
</blockquote>
</div>
<div id="installation-guide" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#installation-guide" class="anchor"></a>Installation Guide</h1>
<p>For the installation, the R package <code>devtools</code> is needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span></code></pre></div>
<p><code>powsimR</code> has a number of dependencies that need to be installed before hand (see also the README file on github). I recommend to install first the dependencies manually and then powsimR. If you plan to use MAGIC for imputation, then please follow their <a href="https://github.com/KrishnaswamyLab/MAGIC">instruction</a> to install the python implementation before installing powsimR.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ipak</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pkg</span>, <span class="va">repository</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'CRAN'</span>, <span class="st">'Bioconductor'</span>, <span class="st">'github'</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">new.pkg</span> <span class="op">&lt;-</span> <span class="va">pkg</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pkg</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>
  <span class="co"># new.pkg &lt;- pkg</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">new.pkg</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">repository</span><span class="op">==</span><span class="st">'CRAN'</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">new.pkg</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">repository</span><span class="op">==</span><span class="st">'Bioconductor'</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">version</span><span class="op">[[</span><span class="st">'version.string'</span><span class="op">]</span><span class="op">]</span>, <span class="st">' '</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&gt;</span> <span class="st">"3.6.0"</span><span class="op">)</span><span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span>
        <span class="op">}</span>
            <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="va">new.pkg</span>, dependencies<span class="op">=</span><span class="cn">TRUE</span>, ask<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">version</span><span class="op">[[</span><span class="st">'version.string'</span><span class="op">]</span><span class="op">]</span>, <span class="st">' '</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;</span> <span class="st">"3.6.0"</span><span class="op">)</span><span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"powsimR depends on packages that are only available in R 3.6.0 and higher."</span><span class="op">)</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">repository</span><span class="op">==</span><span class="st">'github'</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="va">new.pkg</span>, build_vignettes <span class="op">=</span> <span class="cn">FALSE</span>, force <span class="op">=</span> <span class="cn">FALSE</span>, dependencies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># CRAN PACKAGES</span>
<span class="va">cranpackages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"broom"</span>, <span class="st">"cobs"</span>, <span class="st">"cowplot"</span>, 
                  <span class="st">"data.table"</span>, <span class="st">"doParallel"</span>, <span class="st">"dplyr"</span>, <span class="st">"DrImpute"</span>, 
                  <span class="st">"fastICA"</span>, <span class="st">"fitdistrplus"</span>, <span class="st">"foreach"</span>, <span class="st">"future"</span>,
                  <span class="st">"gamlss.dist"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggpubr"</span>, <span class="st">"ggstance"</span>, <span class="st">"grDevices"</span>,
                  <span class="st">"grid"</span>, <span class="st">"Hmisc"</span>, <span class="st">"kernlab"</span>, <span class="st">"MASS"</span>, <span class="st">"magrittr"</span>, <span class="st">"MBESS"</span>, <span class="st">"Matrix"</span>,
                  <span class="st">"matrixStats"</span>, <span class="st">"mclust"</span>, <span class="st">"methods"</span>, <span class="st">"minpack.lm"</span>, <span class="st">"moments"</span>, <span class="st">"msir"</span>, 
                  <span class="st">"NBPSeq"</span>, <span class="st">"nonnest2"</span>, <span class="st">"parallel"</span>, <span class="st">"penalized"</span>, <span class="st">"plyr"</span>, <span class="st">"pscl"</span>,
                  <span class="st">"reshape2"</span>, <span class="st">"Rmagic"</span>, <span class="st">"rsvd"</span>, <span class="st">"Rtsne"</span>, <span class="st">"scales"</span>, <span class="st">"Seurat"</span>, <span class="st">"snow"</span>, <span class="st">"sctransform"</span>, 
                  <span class="st">"stats"</span>, <span class="st">"tibble"</span>, <span class="st">"tidyr"</span>, <span class="st">"truncnorm"</span>, <span class="st">"VGAM"</span>, <span class="st">"ZIM"</span>, <span class="st">"zoo"</span><span class="op">)</span>
<span class="fu">ipak</span><span class="op">(</span><span class="va">cranpackages</span>, repository<span class="op">=</span><span class="st">'CRAN'</span><span class="op">)</span>

<span class="co"># BIOCONDUCTOR</span>
<span class="va">biocpackages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bayNorm"</span>, <span class="st">"baySeq"</span>, <span class="st">"BiocGenerics"</span>, <span class="st">"BiocParallel"</span>, 
                  <span class="st">"DESeq2"</span>, <span class="st">"EBSeq"</span>, <span class="st">"edgeR"</span>, <span class="st">"IHW"</span>, <span class="st">"iCOBRA"</span>,
                  <span class="st">"limma"</span>, <span class="st">"Linnorm"</span>, <span class="st">"MAST"</span>, <span class="st">"monocle"</span>, <span class="st">"NOISeq"</span>, <span class="st">"qvalue"</span>, <span class="st">"ROTS"</span>, <span class="st">"RUVSeq"</span>, 
                  <span class="st">"S4Vectors"</span>, <span class="st">"scater"</span>, <span class="st">"scDD"</span>, <span class="st">"scde"</span>, <span class="st">"scone"</span>, <span class="st">"scran"</span>, <span class="st">"SCnorm"</span>, 
                  <span class="st">"SingleCellExperiment"</span>, <span class="st">"SummarizedExperiment"</span>, <span class="st">"zinbwave"</span><span class="op">)</span>
<span class="fu">ipak</span><span class="op">(</span><span class="va">biocpackages</span>, repository<span class="op">=</span><span class="st">'Bioconductor'</span><span class="op">)</span>

<span class="co"># GITHUB</span>
<span class="va">githubpackages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'cz-ye/DECENT'</span>, <span class="st">'nghiavtr/BPSC'</span>, 
                    <span class="st">'mohuangx/SAVER'</span>, <span class="st">'statOmics/zingeR'</span>,
                    <span class="st">'Vivianstats/scImpute'</span><span class="op">)</span>
<span class="fu">ipak</span><span class="op">(</span><span class="va">githubpackages</span>, repository <span class="op">=</span> <span class="st">'github'</span><span class="op">)</span></code></pre></div>
<p>To check whether all dependencies are installed, you can run the following lines:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">powsimRdeps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Package <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cranpackages</span>, 
                                      <span class="va">biocpackages</span>, 
                                      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">githubpackages</span>, <span class="st">"/"</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, 
                          stringsAsFactors <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">ip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span>, stringsAsFactors <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">ip.check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">powsimRdeps</span>, 
                  Version <span class="op">=</span> <span class="va">ip</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">powsimRdeps</span><span class="op">$</span><span class="va">Package</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">ip</span><span class="op">)</span><span class="op">)</span>,<span class="st">"Version"</span><span class="op">]</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ip.check</span><span class="op">$</span><span class="va">Version</span><span class="op">)</span><span class="op">)</span>  <span class="co"># all should be FALSE</span></code></pre></div>
<p>After installing the dependencies, powsimR can be installed by using devtools as well.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"bvieth/powsimR"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span>, dependencies <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bvieth/powsimR">"powsimR"</a></span><span class="op">)</span></code></pre></div>
<p>Some users have experienced issues installing powsimR due to vignette compilation errors. If that is the case, you can leave out building the vignette (by setting build_vignettes to FALSE).</p>
<p>Alternative, you can try to install powsimR and its dependencies directly using devtools:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"bvieth/powsimR"</span><span class="op">)</span></code></pre></div>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this vignette, we illustrate the features of <code>powsimR</code> by assessing the power to detect differential expression between two groups of mouse embryonic stem cells cultured in standard 2i/LIF culture medium <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE75790">GSE75790</a> <span class="citation">(<a href="#ref-Ziegenhain2017-sf" role="doc-biblioref">Ziegenhain et al. 2017</a>)</span>.</p>
<div id="powsimr-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#powsimr-workflow" class="anchor"></a>powsimR Workflow</h2>
<p>The basic workflow of <code>powsimR</code> is illustrated in Figure @ref(fig:schematic): A) The mean-dispersion relationship is estimated from RNA-seq data, which can be either single cell or bulk data. The user can provide their own count table or a publicly available one and choose whether to fit a negative binomial or a zero-inflated negative binomial. The plot shows a representative example of the mean-dispersion relation estimated, assuming a negative binomial for the Ziegenhain data, the red line is the loess fit, that we later use for the simulations. B) These distribution parameters are then used to set up the simulations in which the user can freely choose the magnitude and amount of differential expression, the sample size configuration as well as the processing pipeline for DE-testing. C) Finally, the error rates are calculated. These can be either returned as marginal estimates per sample configuration, or stratified according to the estimates of mean expression, dispersion or dropout rate. Furthermore, the user can evaluate the analytical choices (e.g. imputation and normalisation).</p>
<div class="figure">
<img src="powsimr_workflow.png" alt="PowsimR schematic overview. We want to investigate the statistical power to detect differential expression in our RNA-seq experiment. Firstly, key expression characteristics of the RNA-seq data, which can be either single cell or bulk data. The plot shows the mean-dispersion estimated, the red line is the loess fit, that we later use for the simulations. The expression of spike-ins can also be modelled. Secondly, we define our desired simulation setup: the number and magnitude of differential expression, the sample size setup as well as the tools to use in our DE-Pipeline. Last, we evaluate the simulated experiment using the error rates of the confusion matrix. Particularly, the power (TPR) and false detection (FDR) are calculated per sample setup configuration." width="480"><p class="caption">
PowsimR schematic overview. We want to investigate the statistical power to detect differential expression in our RNA-seq experiment. Firstly, key expression characteristics of the RNA-seq data, which can be either single cell or bulk data. The plot shows the mean-dispersion estimated, the red line is the loess fit, that we later use for the simulations. The expression of spike-ins can also be modelled. Secondly, we define our desired simulation setup: the number and magnitude of differential expression, the sample size setup as well as the tools to use in our DE-Pipeline. Last, we evaluate the simulated experiment using the error rates of the confusion matrix. Particularly, the power (TPR) and false detection (FDR) are calculated per sample setup configuration.
</p>
</div>
</div>
</div>
<div id="estimation" class="section level1 tabset">
<h1 class="hasAnchor">
<a href="#estimation" class="anchor"></a>Estimation</h1>
<div id="single-cell-gene-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#single-cell-gene-expression" class="anchor"></a>Single Cell Gene Expression</h2>
<p>The parameters of the (zero-inflated) negative binomial distribution, i.e. mean and dispersion are estimated by the function <code>estimateParam</code>. In addition, the dropout probability, i.e. the fraction of zero counts per gene, is calculated.</p>
<p>It is very important to supply the count matrix of a RNA-seq experiment profiling one group of samples or cells only. For example, for bulk please provide the count matrix containing the expression of the untreated samples / wild type <em>ONLY</em>; for single cells please provide the count matrix containing the expression of one cell type sampled from one patient / mouse <em>ONLY</em>, e.g. the expression of monocytes from peripheral mononuclear blood (PBMC) extracted from one patient.</p>
<p>The user can choose between two estimation frameworks:</p>
<ul>
<li>Negative binomial distribution (NB)</li>
<li>Zero-inflated negative binomial distribution (ZINB)</li>
</ul>
<p>In both cases matching moments estimation of mean and dispersion are based on normalized counts.</p>
<p>The user can choose between multiple normalisation methods (see Details section of <code>estimateParam</code>). Furthermore, a number of methods are group sensitive (e.g. batch labels can be provided in SCnorm). For single cell data, it is important to filter out genes and/or cells that are outliers or deemed undetected (see options SampleFilter and GeneFilter).</p>
<p>The estimates, sequencing depth and normalisation factors are plotted with <code>plotParam</code>.</p>
<p>With the following command, we estimate and plot the parameters for the mouse embryonic stem cells profiled with CELseq2 <span class="citation">(<a href="#ref-Ziegenhain2017-sf" role="doc-biblioref">Ziegenhain et al. 2017</a>)</span> (Figure @ref(fig:geneparamsplot)). Firstly, we can examine the quality of the data set using the metrics in Figure @ref(fig:geneparamsplot) A. But most importantly, we see that the variability (i.e. dispersion) and dropout rates are high (Figure @ref(fig:geneparamsplot) B). Furthermore, the dispersion depends on the mean and does not level off with higher mean values compared to bulk data (Figure @ref(fig:geneparamsplot) D).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"CELseq2_Gene_UMI_Counts"</span><span class="op">)</span>
<span class="va">batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">CELseq2_Gene_UMI_Counts</span><span class="op">)</span>, <span class="st">"_"</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">Batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Batch <span class="op">=</span> <span class="va">batch</span>,
                      stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, 
                      row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">CELseq2_Gene_UMI_Counts</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"GeneLengths_mm10"</span><span class="op">)</span>

<span class="co"># estimation</span>
<span class="va">estparam_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateParam.html">estimateParam</a></span><span class="op">(</span>countData <span class="op">=</span> <span class="va">CELseq2_Gene_UMI_Counts</span>,
                          readData <span class="op">=</span> <span class="cn">NULL</span>,
                          batchData <span class="op">=</span> <span class="va">Batches</span>,
                          spikeData <span class="op">=</span> <span class="cn">NULL</span>,
                          spikeInfo <span class="op">=</span> <span class="cn">NULL</span>,
                          Lengths <span class="op">=</span> <span class="va">GeneLengths</span>, MeanFragLengths <span class="op">=</span> <span class="cn">NULL</span>,
                          RNAseq <span class="op">=</span> <span class="st">'singlecell'</span>, Protocol <span class="op">=</span> <span class="st">'UMI'</span>,
                          Distribution <span class="op">=</span> <span class="st">'NB'</span>, Normalisation <span class="op">=</span> <span class="st">"scran"</span>,
                          GeneFilter <span class="op">=</span> <span class="fl">0.1</span>, SampleFilter <span class="op">=</span> <span class="fl">3</span>,
                          sigma <span class="op">=</span> <span class="fl">1.96</span>, NCores <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># plotting</span>
<span class="fu"><a href="../reference/plotParam.html">plotParam</a></span><span class="op">(</span>estParamRes <span class="op">=</span> <span class="va">estparam_gene</span>, Annot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="estparam_gene_celseq2.png" alt="Estimated parameters for CEL-seq2 libraries from Ziegenhain et al. 2017. A) Quality Control Metrics: Sequencing depth; Library size factors with median (black line) for the filtered data set; Detected genes; Ratio of gene to spike-in counts (if spike-ins were provided). Outliers are marked in red. B) Marginal Distribution of gene mean, dispersion and dropout rate per estimation set. C) Number of genes and samples per estimation set. Provided by the user; Detected = number of genes and samples with at least one count; All = number of genes for which mean, dispersion and dropout could be estimated using non-outlying samples. 
Filtered = number of genes above filter threshold for which mean, dispersion and dropout could be estimated using non-outlying samples. Dropout Genes = number of genes filtered out due to dropout rate. D) Local polynomial regression fit between mean and dispersion estimates with variability band per gene (yellow). Common dispersion estimate (grey dashed line). E) Fraction of dropouts versus estimated mean expression per gene." width="755"><p class="caption">
Estimated parameters for CEL-seq2 libraries from Ziegenhain et al. 2017. A) Quality Control Metrics: Sequencing depth; Library size factors with median (black line) for the filtered data set; Detected genes; Ratio of gene to spike-in counts (if spike-ins were provided). Outliers are marked in red. B) Marginal Distribution of gene mean, dispersion and dropout rate per estimation set. C) Number of genes and samples per estimation set. Provided by the user; Detected = number of genes and samples with at least one count; All = number of genes for which mean, dispersion and dropout could be estimated using non-outlying samples. Filtered = number of genes above filter threshold for which mean, dispersion and dropout could be estimated using non-outlying samples. Dropout Genes = number of genes filtered out due to dropout rate. D) Local polynomial regression fit between mean and dispersion estimates with variability band per gene (yellow). Common dispersion estimate (grey dashed line). E) Fraction of dropouts versus estimated mean expression per gene.
</p>
</div>
<p>We have implemented a count simulation framework assuming either a negative binomial distribution or a zero-inflated negative binomial distribution. To predict the dispersion given a random draw of mean expression value observed, we apply a locally weighted polynomial regression fit (solid orange line in Figure @ref(fig:geneparamsplot) D). To capture the variability of dispersion estimates observed, a local variability prediction band is applied (dashed orange lines in Figure @ref(fig:geneparamsplot) D).</p>
<p>For bulk RNA-seq experiments, dropouts are less probable but can still occur. To include this phenomenon we sample from the observed dropout rates for genes that have a mean expression value below 5% dropout probability determined by a decrease constrained B-splines regression of dropout rate against mean expression (<code>cobs</code>).</p>
<p>For the zero-inflated negative binomial distribution, the mean-dispersion relation is similarly estimated, but based on positive read counts. Furthermore, the dropouts are also predicted based on a locally weighted polynomial regression fit between mean and dropouts. Of note, this fit is done separately for amplified and non-amplified transcripts and similar proportions of genes as observed are also generated in the simulations <span class="citation">(<a href="#ref-Ziegenhain2017-sf" role="doc-biblioref">Ziegenhain et al. 2017</a>)</span>.</p>
<p>We and others have found that the negative binomial (NB) distribution is particularly suited for scRNA-seq protocols with UMIs (e.g. SCRB-Seq, Drop-Seq, 10XGenomics) <span class="citation">(<a href="#ref-Svensson2020-ip" role="doc-biblioref">Svensson 2020</a>)</span> whereas non-UMI methods like Smartseq2 show a considerable proportion of genes with zero-inflated count distributions and the zero-inflated negative binomial (ZINB) is then more appropiate <span class="citation">(<a href="#ref-Vieth2017-lh" role="doc-biblioref">Vieth et al. 2017</a>)</span>. In addition, we recommend the NB distribution for bulk RNA-seq and only recommend the option ‘singlecell’ in <code><a href="../reference/estimateParam.html">estimateParam()</a></code> and specialised single cell tools for e.g. normalisation if the data is extremely sparse.</p>
</div>
<div id="spike-ins" class="section level2">
<h2 class="hasAnchor">
<a href="#spike-ins" class="anchor"></a>Spike-Ins</h2>
<p>Some normalisation methods can use spike-ins as part of their normalisation (e.g. SCnorm, scran, Census). We have found that using spike-ins when comparing expression across cells with strong asymmetric differences is important, e.g. comparing resting cells to very transcriptionally active cells <span class="citation">(<a href="#ref-Vieth2019-ld" role="doc-biblioref">Vieth et al. 2019</a>)</span>. To use spike-in information in the simulations, their distributional characteristics need to be estimated. We follow the estimation and simulation framework presented in <span class="citation">(<a href="#ref-Kim2015-zo" role="doc-biblioref">Kim et al. 2015</a>)</span> where the variance is decomposed into shot noise and mRNA loss due to capture and sequencing efficiency. In short, the parameters for a Beta-distribution describes the RNA molecule capture efficiency and the parameters of a Gamma distribution describes the sequencing efficiency, which we can then use to simulate in silico spike-ins given a mean expression value. We assume that biological variance does not contribute to spike-in expression.</p>
<p>The user needs to define the spike-in expression table and the spike-in information table (IDs, molecules, lengths per spike-in) in the function <code>estimateSpike</code>.</p>
<p>The following formula can help the user to calculate the number of molecules of spike-ins:</p>
<p><span class="math display">\[\begin{equation}
    Y_{j} = c_{j} * V * 10^{-3} * D^{-1} * 10^{-18} * {Avogadro}, \quad j=1,\dots,92
\end{equation}\]</span></p>
<p>The number of molecules <span class="math inline">\(Y_{j}\)</span> for each ERCC spike-in species is the product of the molar concentration <span class="math inline">\(c_{j}\)</span> (attomoles per microlitre), the dilution factor <span class="math inline">\(1/D\)</span>, the volume <span class="math inline">\(V\)</span> (nanolitre), Avogadros’ constant (<span class="math inline">\(6.02214129*10^{23}\)</span>) and conversion factors between unit scales.</p>
<p>With the following command, we estimate the parameters for the spike-ins added during library preparation of mouse embryonic stem cells cultured in standard 2i+lif medium <span class="citation">(<a href="#ref-Ziegenhain2017-sf" role="doc-biblioref">Ziegenhain et al. 2017</a>)</span>. Descriptive plots of the spike-ins can be drawn with <code>plotSpike</code> (Figure @ref(fig:spikeplot)).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"CELseq2_SpikeIns_UMI_Counts"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"CELseq2_SpikeInfo"</span><span class="op">)</span>
<span class="va">batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">CELseq2_SpikeIns_UMI_Counts</span><span class="op">)</span>, <span class="st">"_"</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">Batches</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Batch <span class="op">=</span> <span class="va">batch</span>,
                       stringsAsFactors <span class="op">=</span> <span class="cn">F</span>,
                       row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">CELseq2_SpikeIns_UMI_Counts</span><span class="op">)</span><span class="op">)</span>
<span class="co"># estimation</span>
<span class="va">estparam_spike</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateSpike.html">estimateSpike</a></span><span class="op">(</span>spikeData <span class="op">=</span> <span class="va">CELseq2_SpikeIns_UMI_Counts</span>,
spikeInfo <span class="op">=</span> <span class="va">CELseq2_SpikeInfo</span>,
MeanFragLength <span class="op">=</span> <span class="cn">NULL</span>,
batchData <span class="op">=</span> <span class="va">Batches</span>,
Normalisation <span class="op">=</span> <span class="st">'depth'</span><span class="op">)</span>

<span class="co"># plotting</span>
<span class="fu"><a href="../reference/plotSpike.html">plotSpike</a></span><span class="op">(</span><span class="va">estparam_spike</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: centered">
<img src="estparam_spike_celseq2.png" alt="Estimated parameters for the spike-ins added to CEL-seq2 libraries in Ziegenhain et al. 2017 (A) Sequencing depth per sample with median sequencing depth (grey dashed line). (B) Library size normalisation factor per sample with median size factor (grey dashed line). (C) Calibration curve with mean expression estimates and average R squared over all cells. (D) Capture efficiency with binomial logistic regression fit over all cells." width="572"><p class="caption">
Estimated parameters for the spike-ins added to CEL-seq2 libraries in Ziegenhain et al. 2017 (A) Sequencing depth per sample with median sequencing depth (grey dashed line). (B) Library size normalisation factor per sample with median size factor (grey dashed line). (C) Calibration curve with mean expression estimates and average R squared over all cells. (D) Capture efficiency with binomial logistic regression fit over all cells.
</p>
</div>
</div>
</div>
<div id="simulation" class="section level1 tabset">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h1>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>For simulating differential expression between two groups, the number of genes, number of simulations, percentage of differential expression and effect size are set up with the function <code>Setup</code>. The effect size is here defined as the log fold change which can be a constant (e.g. 2), sampled from a vector of anticipated log fold changes (e.g. derived from pilot experiments) or a function. The uniform, normal and gamma distributions are possible options and illustrated in figure @ref(fig:lfcs). Depending on the settings, these distribution can be broader or narrower. If using this option, we recommend to choose a distribution that closely resembles previously observed or expected fold changes. There is also the possibility to include batch effects, see the Details section in <code><a href="../reference/Setup.html">Setup()</a></code>.</p>
<div class="figure">
<img src="lfcdist.png" alt="Examples of Log Fold Changes following a gamma, normal and uniform distribution." width="886"><p class="caption">
Examples of Log Fold Changes following a gamma, normal and uniform distribution.
</p>
</div>
<p>The number of replicates per group (n1 and n2) are also defined in <code>Setup</code> which can be unbalanced. In addition the user can choose to include the simulation of dropout genes so that the resulting count matrix has a percentage of dropouts equal to the rate filtered out during estimation.</p>
<p>The distribution estimates and these settings are then combined into one object.</p>
<p>The following command sets up simulations with 10,000 genes, 5% genes being DE, log fold change sample from a narrow gamma distribution and parameter estimates based on CEL-seq2 libraries in Ziegenhain dataset. The spike-ins are only necessary if we wish to apply imputation, normalisation and/or DE-tools that can utilize spike-ins, see the Details section of <code><a href="../reference/estimateParam.html">estimateParam()</a></code> and <code><a href="../reference/simulateDE.html">simulateDE()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define log fold change</span>
<span class="va">p.lfc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, size<span class="op">=</span><span class="va">x</span>,replace<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">x</span>, shape <span class="op">=</span> <span class="fl">1</span>, rate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># set up simulations</span>
<span class="va">setupres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup.html">Setup</a></span><span class="op">(</span>ngenes <span class="op">=</span> <span class="fl">10000</span>, nsims <span class="op">=</span> <span class="fl">25</span>,
                  p.DE <span class="op">=</span> <span class="fl">0.05</span>, pLFC <span class="op">=</span> <span class="va">p.lfc</span>,
                  n1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">96</span>, <span class="fl">384</span>, <span class="fl">800</span><span class="op">)</span>, n2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">96</span>, <span class="fl">384</span>, <span class="fl">800</span><span class="op">)</span>,
                  Thinning <span class="op">=</span> <span class="cn">NULL</span>, LibSize <span class="op">=</span> <span class="st">'equal'</span>,
                  estParamRes <span class="op">=</span> <span class="va">estparam_gene</span>,
                  estSpikeRes <span class="op">=</span> <span class="cn">NULL</span>,
                  DropGenes <span class="op">=</span> <span class="cn">TRUE</span>,
                  setup.seed <span class="op">=</span> <span class="fl">5299</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="running-differential-expression-simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#running-differential-expression-simulations" class="anchor"></a>Running differential expression simulations</h2>
<p>With the setup defined, the differential expression simulation is run with <code>simulateDE</code>. For this, the user needs to set the following options:</p>
<ul>
<li>
<strong>DEmethod:</strong> The differential testing method. The user can choose between 20 methods in total. 10 developed for bulk, 9 developed for single cells (see the Details section of <code>simulateDE</code>).</li>
<li>
<strong>Normalisation:</strong> The normalisation method. The user can choose between 10 methods in total. 5 developed for bulk, 5 developed for single cells (see the Details section of <code>simulateDE</code>).</li>
</ul>
<p>There are also additional options: Whether to apply a prefiltering or imputation step prior to normalisation; whether spike-in information should be used (if available). For more information, please consult the Details section of <code>simulateDE</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateDE.html">simulateDE</a></span><span class="op">(</span>SetupRes <span class="op">=</span> <span class="va">setupres</span>,
                     Prefilter <span class="op">=</span> <span class="cn">NULL</span>, Imputation <span class="op">=</span> <span class="cn">NULL</span>,
                     Normalisation <span class="op">=</span> <span class="st">'scran'</span>,
                     DEmethod <span class="op">=</span> <span class="st">"limma-trend"</span>, DEFilter <span class="op">=</span> <span class="cn">FALSE</span>,
                     NCores <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="evaluation" class="section level1 tabset">
<h1 class="hasAnchor">
<a href="#evaluation" class="anchor"></a>Evaluation</h1>
<p>The results of the simulations can now be evaluated. Primarily the differential expression in terms of power can be examined with <code>evaluateDE</code> and <code>evaluateROC</code>. In addition, we can also check in how far our chosen pipeline tools perform in terms of log fold change estimates and normalisation with <code>evaluateSim</code>.</p>
<div id="differential-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#differential-expression" class="anchor"></a>Differential Expression</h2>
<p>The results of differential expression simulation are evaluated with <code>evaluateDE</code>. We have separated the evaluation from DE detection to allow the user to evaluate power in a comprehensive way as advocated by <span class="citation">(<a href="#ref-Wu2015-uj" role="doc-biblioref">Wu, Wang, and Wu 2015</a>)</span>. In this function, the proportions and error rates are estimated. The rates can be stratified by mean, dispersion, dropout or log fold change. Furthermore, the user can choose between different multiple testing correction methods (see <code><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust.methods()</a></code>, <code>ihw()</code> in and <code>qvalue()</code> in ). Also, the genes can be filtered by mean, dispersion or dropout. To define biologically interesting genes, a cutoff for the log fold change with <code>delta</code> can be set.</p>
<p>With the following command we evaluate the marginal TPR and FDR conditional on the mean expression:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">evalderes</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluateDE.html">evaluateDE</a></span><span class="op">(</span>simRes <span class="op">=</span> <span class="va">simres</span>,
                     alpha.type <span class="op">=</span> <span class="st">'adjusted'</span>,
                     MTC <span class="op">=</span> <span class="st">'BH'</span>,
                     alpha.nominal <span class="op">=</span> <span class="fl">0.1</span>,
                     stratify.by <span class="op">=</span> <span class="st">'mean'</span>,
                     filter.by <span class="op">=</span> <span class="st">'none'</span>,
                     strata.filtered <span class="op">=</span> <span class="fl">1</span>,
                     target.by <span class="op">=</span> <span class="st">'lfc'</span>,
                     delta <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>The results of the evaluation can be plotted with <code><a href="../reference/plotEvalDE.html">plotEvalDE()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotEvalDE.html">plotEvalDE</a></span><span class="op">(</span>evalRes <span class="op">=</span> <span class="va">evalderes</span>, rate <span class="op">=</span> <span class="st">'marginal'</span>, quick <span class="op">=</span> <span class="cn">TRUE</span>, Annot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotEvalDE.html">plotEvalDE</a></span><span class="op">(</span>evalRes <span class="op">=</span> <span class="va">evalderes</span>, rate <span class="op">=</span> <span class="st">'conditional'</span>, quick <span class="op">=</span> <span class="cn">TRUE</span>, Annot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<strong>rate:</strong> The user can choose to plot the ‘marginal’ or ‘stratified’ error rates. The number of genes per stratum are also summarised.</li>
<li>
<strong>quick:</strong> If this is set to <code>TRUE</code> then only the TPR and FDR will be plotted.</li>
</ul>
<p>The quick marginal and conditional power assessment for the Ziegenhain data is plotted in Figure @ref(fig:evaldeplot1) and @ref(fig:evaldeplot2). As expected the power (TPR) to detect differential expression increases with sample size (Figure @ref(fig:evaldeplot1)). On the other hand, the ability to control the false detection (FDR) at the chosen nominal level depends on the average expression of DE genes (Figure @ref(fig:evaldeplot2)). Furthermore, the detection of true positives with small mean expression needs far more replicates per group.</p>
<div class="figure">
<img src="evalderes_marginal_celseq2.png" alt="Marginal Error Rates. (A) Marginal FDR and TPR per sample size comparison. (B) Marginal FDR and TPR per sample size comparison with dashed line indicating nominal alpha level (type I error) and nominal 1-beta level, i.e. 80% power (type II error)." width="584"><p class="caption">
Marginal Error Rates. (A) Marginal FDR and TPR per sample size comparison. (B) Marginal FDR and TPR per sample size comparison with dashed line indicating nominal alpha level (type I error) and nominal 1-beta level, i.e. 80% power (type II error).
</p>
</div>
<div class="figure">
<img src="evalderes_conditional_celseq2.png" alt="Stratified Error Rates. (A) Conditional FDR and TPR per sample size comparison per stratum. (B) Number of equally (EE) and differentially expressed (DE) genes per stratum." width="584"><p class="caption">
Stratified Error Rates. (A) Conditional FDR and TPR per sample size comparison per stratum. (B) Number of equally (EE) and differentially expressed (DE) genes per stratum.
</p>
</div>
<p>In addition to the classical evaluation of power analyses, <code>powsimR</code> also includes the option to evaluate the simulations using summary metrics such as the Receiver-Operator-Characteristic (ROC) Curve as well as accuracy, F1 score and Matthews Correlation Coefficient.</p>
<p>With the following command we calculate these metrics with <code><a href="../reference/evaluateROC.html">evaluateROC()</a></code> and plot them with <code><a href="../reference/plotEvalROC.html">plotEvalROC()</a></code>. The classical ROC curve as well as precision-recall curve, which is more appropiate for imbalanced number of true positives and negatives, can be helpful to identify the optimal sample size setup (Figure @ref(fig:evalrocresplot) A and B). Most importantly, we can check if the FDR is controlled at the chosen nominal level (Figure @ref(fig:evalrocresplot) C). If that is not the case, then the chosen pipeline, particularly the normalisation and DE testing, might be an issue <span class="citation">(<a href="#ref-Vieth2019-ld" role="doc-biblioref">Vieth et al. 2019</a>)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">evalrocres</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluateROC.html">evaluateROC</a></span><span class="op">(</span>simRes <span class="op">=</span> <span class="va">simres</span>,
                         alpha.type<span class="op">=</span><span class="st">"adjusted"</span>,
                         MTC<span class="op">=</span><span class="st">'BH'</span>,
                         alpha.nominal <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotEvalROC.html">plotEvalROC</a></span><span class="op">(</span>evalRes <span class="op">=</span> <span class="va">evalrocres</span>, cutoff <span class="op">=</span> <span class="st">"liberal"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="evalrocres_liberal_celseq2.png" alt="A) Receiver-Operator-Characteristics (ROC) Curve per sample size setup. 
B) Precision-Recall (PR) Curve per sample size setup. 
C) TPR versus observed FDR per sample size setup. The filling of the point indicates whether FDR is controlled at the chosen nominal level. 
D) Summary Statistics per sample size setup rounded to two digits." width="570"><p class="caption">
</p>
<ol style="list-style-type: upper-alpha">
<li>Receiver-Operator-Characteristics (ROC) Curve per sample size setup.</li>
<li>Precision-Recall (PR) Curve per sample size setup.</li>
<li>TPR versus observed FDR per sample size setup. The filling of the point indicates whether FDR is controlled at the chosen nominal level.</li>
<li>Summary Statistics per sample size setup rounded to two digits.

</li>
</ol>
</div>

</div>
<div id="pipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#pipeline" class="anchor"></a>Pipeline</h2>
<p>We can also check in how far our pipeline choices are affecting our ability to correctly identify differential expression in <code><a href="../reference/evaluateSim.html">evaluateSim()</a></code>.</p>
<p>With the following command we calculate these metrics. Of note here is particular in how far our estimated log fold changes deviate from the simulated fold changes as well as how the normalisation is able to ensure comparability across sample groups (Figure @(fig:evalsimresplot)).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">evalsimres</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluateSim.html">evaluateSim</a></span><span class="op">(</span>simRes <span class="op">=</span> <span class="va">simres</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotEvalSim.html">plotEvalSim</a></span><span class="op">(</span>evalRes <span class="op">=</span> <span class="va">evalsimres</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotTime.html">plotTime</a></span><span class="op">(</span>evalRes <span class="op">=</span> <span class="va">evalsimres</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="evalsimres_celseq2.png" alt="Pipeline Evaluation. A) Mean Absolute Error (MAE), Root Mean Squared Error (RMSE) and robust Root Mean Squared Error (rRMSE) for the estimated log fold changes of all (ALL), differentially expressed (DE) and equally expressed (EE) genes compared to the true log fold changes. 
B) Median absolute deviation (MAD) and robust Root Mean Squared Error (rRMSE) between estimated and simulated size factors. 
C) The average ratio between simulated and estimated size factors in the two groups per sample size setup. All values are mean +/- standard error." width="670"><p class="caption">
Pipeline Evaluation. A) Mean Absolute Error (MAE), Root Mean Squared Error (RMSE) and robust Root Mean Squared Error (rRMSE) for the estimated log fold changes of all (ALL), differentially expressed (DE) and equally expressed (EE) genes compared to the true log fold changes. B) Median absolute deviation (MAD) and robust Root Mean Squared Error (rRMSE) between estimated and simulated size factors. C) The average ratio between simulated and estimated size factors in the two groups per sample size setup. All values are mean +/- standard error.
</p>
</div>
<div class="figure">
<img src="evaltime_celseq2.png" alt="Computational Run Time in seconds per simulateDE() pipeline step." width="572"><p class="caption">
Computational Run Time in seconds per simulateDE() pipeline step.
</p>
</div>
</div>
</div>
<div id="additional-functionalities" class="section level1 tabset">
<h1 class="hasAnchor">
<a href="#additional-functionalities" class="anchor"></a>Additional Functionalities</h1>
<div id="estimation-1" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation-1" class="anchor"></a>Estimation</h2>
<div id="count-matrices-of-single-cell-rna-seq-experiments" class="section level3">
<h3 class="hasAnchor">
<a href="#count-matrices-of-single-cell-rna-seq-experiments" class="anchor"></a>Count matrices of single cell RNA-seq experiments</h3>
<p>We have uploaded count matrices of 5 single cell RNA-seq experiments on <a href="https://github.com/bvieth/powsimRData">github</a>. In <code>powsimR</code>, we have included subsampled versions of these data sets, see description on the help page <code>GeneCounts</code>. The user can calculate the negative binomial parameters with <code><a href="../reference/estimateParam.html">estimateParam()</a></code>, view these estimates with <code><a href="../reference/plotParam.html">plotParam()</a></code> and use it as an input for simulations.</p>
</div>
<div id="access-to-raw-read-counts-stored-in-online-data-bases" class="section level3">
<h3 class="hasAnchor">
<a href="#access-to-raw-read-counts-stored-in-online-data-bases" class="anchor"></a>Access to raw read counts stored in online data bases</h3>
<p>We have provided a number of exemplary single cell RNA-seq data sets for parameter estimation. Nevertheless, you might not find a data set that matches your own experimental setup. In those cases, we recommend to check online repositories for a suitable data set. Below you can find an example script to get count tables from <a href="https://jhubiostatistics.shinyapps.io/recount/">recount2</a> <span class="citation">(<a href="#ref-Collado-Torres2017-mo" role="doc-biblioref">Collado-Torres et al. 2017</a>)</span>. For a single cell RNA-seq data base, see <a href="http://imlspenticton.uzh.ch:3838/conquer/">conquer</a> <span class="citation">(<a href="#ref-Soneson2018-xe" role="doc-biblioref">Soneson and Robinson 2018</a>)</span>.</p>
<p>As before, the user can then estimate the negative binomial parameters with <code><a href="../reference/estimateParam.html">estimateParam()</a></code>, view these estimates with <code><a href="../reference/plotParam.html">plotParam()</a></code> and use it as an input for <code><a href="../reference/Setup.html">Setup()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install and load the R package</span>
<span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">"recount"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/leekgroup/recount">'recount'</a></span><span class="op">)</span>

<span class="co"># Download the data set</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/recount/man/download_study.html">download_study</a></span><span class="op">(</span><span class="st">'SRP060416'</span><span class="op">)</span>

<span class="co"># Load the data</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'SRP060416'</span>, <span class="st">'rse_gene.Rdata'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># count table</span>
<span class="va">cnts</span> <span class="op">&lt;-</span> <span class="fu">assay</span><span class="op">(</span><span class="va">rse_gene</span><span class="op">)</span>
<span class="co"># sample annotation</span>
<span class="va">sample.info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">rse_gene</span><span class="op">)</span><span class="op">@</span><span class="va">listData</span>, 
                          stringsAsFactors<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="co"># gene annotation</span>
<span class="va">gene.info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>GeneID<span class="op">=</span><span class="fu">rowData</span><span class="op">(</span><span class="va">rse_gene</span><span class="op">)</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">gene_id</span>, 
                        GeneLength<span class="op">=</span><span class="fu">rowData</span><span class="op">(</span><span class="va">rse_gene</span><span class="op">)</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">bp_length</span>, 
                        stringsAsFactors<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="what-is-the-best-fitting-distribution-for-my-data" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-the-best-fitting-distribution-for-my-data" class="anchor"></a>What is the best fitting distribution for my data?</h2>
<p>It is important to validate the appropriateness of the chosen simulation framework. The function <code><a href="../reference/evaluateDist.html">evaluateDist()</a></code> compares the theoretical fit of the Poisson, negative binomial, zero-inflated Poisson and zero-inflated negative binomial and beta-Poisson distribution to the empirical RNA-seq read counts (<span class="citation">(<a href="#ref-Colin_Cameron2013-vb" role="doc-biblioref">Colin Cameron and Trivedi 2013</a>)</span>, <span class="citation">(<a href="#ref-Kim2013-qo" role="doc-biblioref">Kim and Marioni 2013</a>)</span>, <span class="citation">(<a href="#ref-Delmans2016-ef" role="doc-biblioref">Delmans and Hemberg 2016</a>)</span>).</p>
<p>The evaluation is then plotted with the function <code><a href="../reference/plotEvalDist.html">plotEvalDist()</a></code> which summarizes the best fitting distribution per gene based on goodness-of-fit statistics (Chi-square test), Akaike Information Criterium, comparing observed dropouts with zero count prediction of the models and comparing the model fitness with Likelihood Ratio Test and Vuong Test.</p>
<p>As noted by other developers, goodness-of-fit tests are not an objective tool and heavily depend on sample sizes <span class="citation">(<a href="#ref-Delignette-Muller2015-ie" role="doc-biblioref">Delignette-Muller and Dutang 2015</a>)</span>. A graphical evaluation of the fitted distribution is considered the most appropriate way but for high-throughput sequencing this is an unrealistic recommendation. Bulk RNA-seq experiments are usually conducted with a small number of samples. We therefore recommend to rely on the goodness-of-fit validation by <span class="citation">(<a href="#ref-Mi2015-ri" role="doc-biblioref">Mi, Di, and Schafer 2015</a>)</span>.</p>
<p>With the following command, we determine and plot the fitting for the embryonic stem cells cultured in standard 2i+lif medium profiled with the Smartseq2 protocol <span class="citation">(<a href="#ref-Ziegenhain2017-sf" role="doc-biblioref">Ziegenhain et al. 2017</a>)</span>. Note that the results shown in Figure @ref(fig:evaldistplot) will differ from the executed command since I reduced the data set and evaluate the fitting only for a fraction of genes.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SmartSeq2_Gene_Read_Counts"</span><span class="op">)</span>
<span class="va">evalDistRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluateDist.html">evaluateDist</a></span><span class="op">(</span>countData <span class="op">=</span> <span class="va">SmartSeq2_Gene_Read_Counts</span>, 
                            batchData <span class="op">=</span> <span class="cn">NULL</span>,
                            spikeData <span class="op">=</span> <span class="cn">NULL</span>, spikeInfo <span class="op">=</span> <span class="cn">NULL</span>,
                            Lengths <span class="op">=</span> <span class="cn">NULL</span>, MeanFragLengths <span class="op">=</span> <span class="cn">NULL</span>,
                            RNAseq <span class="op">=</span> <span class="st">"singlecell"</span>, Protocol <span class="op">=</span> <span class="st">"UMI"</span>,
                            Normalisation <span class="op">=</span> <span class="st">"scran"</span>,
                            GeneFilter <span class="op">=</span> <span class="fl">0.1</span>, SampleFilter <span class="op">=</span> <span class="fl">3</span>,
                            FracGenes <span class="op">=</span> <span class="fl">0.1</span>,
                            verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotEvalDist.html">plotEvalDist</a></span><span class="op">(</span><span class="va">evalDistRes</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="evaldist_smartseq2.png" alt="Distribution Evaluation. A) Goodness-of-fit of the model assessed with a Chi-Square Test based on residual deviance and degrees of freedom. B) Akaike Information Criterion per gene: Model with the lowest AIC. Model with the lowest AIC and passed goodness-of-fit statistic test.  C) Observed versus predicted dropouts per model and gene plotted without outliers. D) Model Assessment based on LRT for nested models and Vuong test for nonnested models." width="396"><p class="caption">
Distribution Evaluation. A) Goodness-of-fit of the model assessed with a Chi-Square Test based on residual deviance and degrees of freedom. B) Akaike Information Criterion per gene: Model with the lowest AIC. Model with the lowest AIC and passed goodness-of-fit statistic test. C) Observed versus predicted dropouts per model and gene plotted without outliers. D) Model Assessment based on LRT for nested models and Vuong test for nonnested models.
</p>
</div>
</div>
<div id="simulation-settings" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-settings" class="anchor"></a>Simulation Settings</h2>
<div id="phenotypic-differences-only-in-a-subset-of-replicates" class="section level3">
<h3 class="hasAnchor">
<a href="#phenotypic-differences-only-in-a-subset-of-replicates" class="anchor"></a>Phenotypic differences only in a subset of replicates</h3>
<p>By default, all replicates per group express the phenotypic differences in gene expression defined by <code>pLFC</code>. If the user wishes for a more varied expression profile, i.e. only a proportion of replicates per group with a difference in expression, these patterns can be defined by changing <code>p.G</code> (see Details section of <code><a href="../reference/Setup.html">Setup()</a></code>).</p>
</div>
<div id="include-differences-in-library-sizes" class="section level3">
<h3 class="hasAnchor">
<a href="#include-differences-in-library-sizes" class="anchor"></a>Include differences in library sizes</h3>
<p>By default, there is no difference in library sizes between the samples. If the user wishes for a more realistic, i.e. more variable distribution of read counts across samples, the library sizes can be sampled from observed, vector or function (see Details section of <code><a href="../reference/Setup.html">Setup()</a></code>).</p>
</div>
<div id="downsample-simulated-count-matrices-by-binomial-thinning" class="section level3">
<h3 class="hasAnchor">
<a href="#downsample-simulated-count-matrices-by-binomial-thinning" class="anchor"></a>Downsample simulated count matrices by binomial thinning</h3>
<p>There is the additional option to downsample simulated count matrices with the option <code>Thinning</code> in <code><a href="../reference/Setup.html">Setup()</a></code> in order to know in how far a shallower sequencing depth affects the power to detect differential expression. For example, the estimation was done using 500 cells and in the simulations we would like to compare two groups with a total of 1000 cells but do not want to increase the sequencing depth compared to the pilot data. Thus we can set the Thinning parameters to 0.5 to half the number of counts per cell. Please note, that the thinning assumes that the count matrix is based on reads, not UMIs. For UMI-methods, please supply the UMI count matrix as <code>countData</code> in <code><a href="../reference/estimateParam.html">estimateParam()</a></code> and the raw read count matrix without UMI deduplication as <code>readData</code>. For more information, please check out the help page of <code><a href="../reference/estimateParam.html">estimateParam()</a></code>.</p>
<p>Below you can find an example script using the CELSeq2 libraries from Ziegenhain et al.:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"CELseq2_Gene_UMI_Counts"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"CELseq2_Gene_Read_Counts"</span><span class="op">)</span>
<span class="va">batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">CELseq2_Gene_UMI_Counts</span><span class="op">)</span>, <span class="st">"_"</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">Batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Batch <span class="op">=</span> <span class="va">batch</span>,
                      stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, 
                      row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">CELseq2_Gene_UMI_Counts</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"GeneLengths_mm10"</span><span class="op">)</span>

<span class="co"># estimation</span>
<span class="va">estparam_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateParam.html">estimateParam</a></span><span class="op">(</span>countData <span class="op">=</span> <span class="va">CELseq2_Gene_UMI_Counts</span>,
                               readData <span class="op">=</span> <span class="va">CELseq2_Gene_Read_Counts</span>,
                               batchData <span class="op">=</span> <span class="va">Batches</span>,
                               spikeData <span class="op">=</span> <span class="cn">NULL</span>,
                               spikeInfo <span class="op">=</span> <span class="cn">NULL</span>,
                               Lengths <span class="op">=</span> <span class="va">GeneLengths</span>, MeanFragLengths <span class="op">=</span> <span class="cn">NULL</span>,
                               RNAseq <span class="op">=</span> <span class="st">'singlecell'</span>, Protocol <span class="op">=</span> <span class="st">'UMI'</span>,
                               Distribution <span class="op">=</span> <span class="st">'NB'</span>, Normalisation <span class="op">=</span> <span class="st">"scran"</span>,
                               GeneFilter <span class="op">=</span> <span class="fl">0.1</span>, SampleFilter <span class="op">=</span> <span class="fl">3</span>,
                               sigma <span class="op">=</span> <span class="fl">1.96</span>, NCores <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotParam.html">plotParam</a></span><span class="op">(</span>estParamRes <span class="op">=</span> <span class="va">estparam_gene</span><span class="op">)</span>

<span class="co"># define log fold change</span>
<span class="va">p.lfc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, size<span class="op">=</span><span class="va">x</span>,replace<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">x</span>, shape <span class="op">=</span> <span class="fl">1</span>, rate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="co"># set up simulations</span>
<span class="va">setupres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup.html">Setup</a></span><span class="op">(</span>ngenes <span class="op">=</span> <span class="fl">10000</span>, nsims <span class="op">=</span> <span class="fl">25</span>,
                  p.DE <span class="op">=</span> <span class="fl">0.1</span>, pLFC <span class="op">=</span> <span class="va">p.lfc</span>,
                  n1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>, n2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>,
                  Thinning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>, LibSize <span class="op">=</span> <span class="st">'given'</span>,
                  estParamRes <span class="op">=</span> <span class="va">estparam_gene</span>,
                  estSpikeRes <span class="op">=</span> <span class="cn">NULL</span>,
                  DropGenes <span class="op">=</span> <span class="cn">TRUE</span>,
                  setup.seed <span class="op">=</span> <span class="fl">5299</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># run simulations</span>
<span class="va">simres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateDE.html">simulateDE</a></span><span class="op">(</span>SetupRes <span class="op">=</span> <span class="va">setupres</span>,
                     Prefilter <span class="op">=</span> <span class="st">"FreqFilter"</span>, Imputation <span class="op">=</span> <span class="cn">NULL</span>,
                     Normalisation <span class="op">=</span> <span class="st">'scran'</span>,
                     DEmethod <span class="op">=</span> <span class="st">"limma-trend"</span>, DEFilter <span class="op">=</span> <span class="cn">FALSE</span>,
                     NCores <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="session-info" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<p>Here is the output of <code><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo()</a></code> on the system on which this document was compiled:</p>
<pre><code>R version 4.0.3 (2020-10-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 18.04.5 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas/libblas.so.3
LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.2.20.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=de_DE.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=de_DE.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] qvalue_2.22.0    IHW_1.18.0       rmdformats_1.0.0 knitr_1.30      

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.5          plyr_1.8.6          pillar_1.4.7       
 [4] compiler_4.0.3      formatR_1.7         highr_0.8          
 [7] tools_4.0.3         digest_0.6.27       tibble_3.0.4       
[10] evaluate_0.14       memoise_1.1.0       lifecycle_0.2.0    
[13] gtable_0.3.0        pkgconfig_2.0.3     png_0.1-7          
[16] rlang_0.4.9         lpsymphony_1.18.0   rstudioapi_0.13    
[19] yaml_2.2.1          parallel_4.0.3      pkgdown_1.6.1      
[22] xfun_0.19           dplyr_1.0.2         stringr_1.4.0      
[25] generics_0.1.0      vctrs_0.3.5         desc_1.2.0         
[28] fs_1.5.0            systemfonts_0.3.2   tidyselect_1.1.0   
[31] rprojroot_2.0.2     grid_4.0.3          glue_1.4.2         
[34] R6_2.5.0            textshaping_0.2.1   fdrtool_1.2.15     
[37] rmarkdown_2.5       bookdown_0.21       reshape2_1.4.4     
[40] purrr_0.3.4         ggplot2_3.3.2       magrittr_2.0.1     
[43] splines_4.0.3       ellipsis_0.3.1      scales_1.1.1       
[46] htmltools_0.5.0     BiocGenerics_0.36.0 assertthat_0.2.1   
[49] colorspace_2.0-0    ragg_0.4.0          stringi_1.5.3      
[52] munsell_0.5.0       slam_0.1-47         crayon_1.3.4       </code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Colin_Cameron2013-vb" class="csl-entry">
Colin Cameron, A, and Pravin K Trivedi. 2013. <em>Regression Analysis of Count Data (econometric Society Monographs)</em>. 2 edition. Cambridge University Press.
</div>
<div id="ref-Collado-Torres2017-mo" class="csl-entry">
Collado-Torres, Leonardo, Abhinav Nellore, Kai Kammers, Shannon E Ellis, Margaret A Taub, Kasper D Hansen, Andrew E Jaffe, Ben Langmead, and Jeffrey T Leek. 2017. <span>“Reproducible <span class="nocase">RNA-seq</span> Analysis Using Recount2.”</span> <em>Nat. Biotechnol.</em> 35 (4): 319–21. <a href="https://doi.org/10.1038/nbt.3838">https://doi.org/10.1038/nbt.3838</a>.
</div>
<div id="ref-Delignette-Muller2015-ie" class="csl-entry">
Delignette-Muller, Marie, and Christophe Dutang. 2015. <span>“Fitdistrplus: An <span>R</span> Package for Fitting Distributions.”</span> <em>J. Stat. Softw.</em> 64 (1): 1–34. <a href="https://doi.org/10.18637/jss.v064.i04">https://doi.org/10.18637/jss.v064.i04</a>.
</div>
<div id="ref-Delmans2016-ef" class="csl-entry">
Delmans, Mihails, and Martin Hemberg. 2016. <span>“Discrete Distributional Differential Expression (<span class="nocase">D3E)–a</span> Tool for Gene Expression Analysis of Single-Cell <span class="nocase">RNA-seq</span> Data.”</span> <em>BMC Bioinformatics</em> 17: 110. <a href="https://doi.org/10.1186/s12859-016-0944-6">https://doi.org/10.1186/s12859-016-0944-6</a>.
</div>
<div id="ref-Kim2015-zo" class="csl-entry">
Kim, Jong Kyoung, Aleksandra A Kolodziejczyk, Tomislav Illicic, Sarah A Teichmann, and John C Marioni. 2015. <span>“Characterizing Noise Structure in Single-Cell <span class="nocase">RNA-seq</span> Distinguishes Genuine from Technical Stochastic Allelic Expression.”</span> <em>Nat. Commun.</em> 6: 8687. <a href="https://doi.org/10.1038/ncomms9687">https://doi.org/10.1038/ncomms9687</a>.
</div>
<div id="ref-Kim2013-qo" class="csl-entry">
Kim, Jong Kyoung, and John C Marioni. 2013. <span>“Inferring the Kinetics of Stochastic Gene Expression from Single-Cell <span class="nocase">RNA-sequencing</span> Data.”</span> <em>Genome Biol.</em> 14 (1): R7. <a href="https://doi.org/10.1186/gb-2013-14-1-r7">https://doi.org/10.1186/gb-2013-14-1-r7</a>.
</div>
<div id="ref-Mi2015-ri" class="csl-entry">
Mi, Gu, Yanming Di, and Daniel W Schafer. 2015. <span>“Goodness-of-Fit Tests and Model Diagnostics for Negative Binomial Regression of <span>RNA</span> Sequencing Data.”</span> <em>PLoS One</em> 10 (3): e0119254. <a href="https://doi.org/10.1371/journal.pone.0119254">https://doi.org/10.1371/journal.pone.0119254</a>.
</div>
<div id="ref-Soneson2018-xe" class="csl-entry">
Soneson, Charlotte, and Mark D Robinson. 2018. <span>“Bias, Robustness and Scalability in Single-Cell Differential Expression Analysis.”</span> <em>Nat. Methods</em>, February. <a href="https://doi.org/10.1038/nmeth.4612">https://doi.org/10.1038/nmeth.4612</a>.
</div>
<div id="ref-Svensson2020-ip" class="csl-entry">
Svensson, Valentine. 2020. <span>“Droplet <span class="nocase">scRNA-seq</span> Is Not Zero-Inflated.”</span> <em>Nat. Biotechnol.</em>, January. <a href="https://doi.org/10.1038/s41587-019-0379-5">https://doi.org/10.1038/s41587-019-0379-5</a>.
</div>
<div id="ref-Vieth2019-ld" class="csl-entry">
Vieth, Beate, Swati Parekh, Christoph Ziegenhain, Wolfgang Enard, and Ines Hellmann. 2019. <span>“A Systematic Evaluation of Single Cell <span class="nocase">RNA-seq</span> Analysis Pipelines.”</span> <em>Nat. Commun.</em> 10 (1): 4667. <a href="https://doi.org/10.1038/s41467-019-12266-7">https://doi.org/10.1038/s41467-019-12266-7</a>.
</div>
<div id="ref-Vieth2017-lh" class="csl-entry">
Vieth, Beate, Christoph Ziegenhain, Swati Parekh, Wolfgang Enard, and Ines Hellmann. 2017. <span>“powsimR: Power Analysis for Bulk and Single Cell <span class="nocase">RNA-seq</span> Experiments.”</span> <em>Bioinformatics</em> 33 (21): 3486–88. <a href="https://doi.org/10.1093/bioinformatics/btx435">https://doi.org/10.1093/bioinformatics/btx435</a>.
</div>
<div id="ref-Wu2015-uj" class="csl-entry">
Wu, Hao, Chi Wang, and Zhijin Wu. 2015. <span>“<span>PROPER</span>: Comprehensive Power Evaluation for Differential Expression Using <span class="nocase">RNA-seq</span>.”</span> <em>Bioinformatics</em> 31 (2): 233–41. <a href="https://doi.org/10.1093/bioinformatics/btu640">https://doi.org/10.1093/bioinformatics/btu640</a>.
</div>
<div id="ref-Ziegenhain2017-sf" class="csl-entry">
Ziegenhain, Christoph, Beate Vieth, Swati Parekh, Björn Reinius, Amy Guillaumet-Adkins, Martha Smets, Heinrich Leonhardt, Holger Heyn, Ines Hellmann, and Wolfgang Enard. 2017. <span>“Comparative Analysis of <span>Single-Cell</span> <span>RNA</span> Sequencing Methods.”</span> <em>Mol. Cell</em> 65 (4): 631–643.e4. <a href="https://doi.org/10.1016/j.molcel.2017.01.023">https://doi.org/10.1016/j.molcel.2017.01.023</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Beate Vieth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
