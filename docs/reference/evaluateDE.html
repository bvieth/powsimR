<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute the confusion matrix-related quantities from simulation results — evaluateDE • powsimR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute the confusion matrix-related quantities from simulation results — evaluateDE" />
<meta property="og:description" content="This function takes the simulation output from simulateDE
and computes quantities of the confusion matrix for statistical power evaluation." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">powsimR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/powsimR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bvieth/powsimR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute the confusion matrix-related quantities from simulation results</h1>
    <small class="dont-index">Source: <a href='https://github.com/bvieth/powsimR/blob/master/R/Evaluate.R'><code>R/Evaluate.R</code></a></small>
    <div class="hidden name"><code>evaluateDE.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function takes the simulation output from <code><a href='simulateDE.html'>simulateDE</a></code>
and computes quantities of the confusion matrix for statistical power evaluation.</p>
    </div>

    <pre class="usage"><span class='fu'>evaluateDE</span>(<span class='no'>simRes</span>,
<span class='kw'>alpha.type</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"adjusted"</span>,<span class='st'>"raw"</span>),
<span class='kw'>MTC</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'BY'</span>, <span class='st'>'BH'</span>, <span class='st'>'holm'</span>, <span class='st'>'hochberg'</span>, <span class='st'>'hommel'</span>, <span class='st'>'bonferroni'</span>, <span class='st'>'Storey'</span>, <span class='st'>'IHW'</span>),
<span class='kw'>alpha.nominal</span><span class='kw'>=</span><span class='fl'>0.1</span>,
<span class='kw'>stratify.by</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mean"</span>, <span class='st'>"dispersion"</span>, <span class='st'>"dropout"</span>, <span class='st'>"lfc"</span>),
<span class='kw'>strata.probs</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.1</span>, <span class='fl'>0.2</span>, <span class='fl'>0.3</span>, <span class='fl'>0.4</span>, <span class='fl'>0.5</span>, <span class='fl'>0.6</span>, <span class='fl'>0.7</span>, <span class='fl'>0.8</span>, <span class='fl'>0.9</span>),
<span class='kw'>filter.by</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"none"</span>, <span class='st'>"mean"</span>, <span class='st'>"dispersion"</span>, <span class='st'>"dropout"</span>),
<span class='kw'>strata.filtered</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>target.by</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"lfc"</span>, <span class='st'>"effectsize"</span>), <span class='kw'>delta</span><span class='kw'>=</span><span class='fl'>0</span>,
<span class='kw'>Table</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>simRes</th>
      <td><p>The result from <code><a href='simulateDE.html'>simulateDE</a></code>.</p></td>
    </tr>
    <tr>
      <th>alpha.type</th>
      <td><p>A string to represent the way to call DE genes.
Available options are <code>"adjusted"</code> i.e. applying multiple testing correction and
<code>"raw"</code> i.e. using p-values. Default is <code>"adjusted"</code>.</p></td>
    </tr>
    <tr>
      <th>MTC</th>
      <td><p>Multiple testing correction method to use. Available options are
1) see <a href='https://rdrr.io/r/stats/p.adjust.html'>p.adjust.methods</a>,
2) Storey's qvalue see <a href='https://rdrr.io/pkg/qvalue/man/qvalue.html'>qvalue</a> and
3) Independent Hypothesis Weighting considering mean expression as covariate (see <a href='https://rdrr.io/pkg/IHW/man/ihw.default.html'>ihw</a>).
Default is <code>BY</code>, i.e. Benjamini-Yekutieli FDR correction method.</p></td>
    </tr>
    <tr>
      <th>alpha.nominal</th>
      <td><p>The nomial level of significance. Default is 0.1.</p></td>
    </tr>
    <tr>
      <th>stratify.by</th>
      <td><p>A string to represent the way to stratify genes.
Available options are <code>"mean"</code>, <code>"dispersion"</code>, <code>"dropout"</code> and <code>"lfc"</code>,
for stratifying genes by average expression levels, dispersion, dropout rates or estimated log2 fold changes.</p></td>
    </tr>
    <tr>
      <th>strata.probs</th>
      <td><p>A vector specifying the probability values for sample quantiles of the strata. See <a href='https://rdrr.io/pkg/qvalue/man/qvalue.html'>qvalue</a>.</p></td>
    </tr>
    <tr>
      <th>filter.by</th>
      <td><p>A string to represent the way to filter genes.
This is used in conjunction with strata.filtered for gene filtering.
Available options are <code>"none"</code>, <code>"mean"</code>, <code>"dispersion"</code> and <code>"dropout"</code>.
<code>"none"</code> stands for no filtering, thus all genes will be considered.
<code>"mean"</code> stands for filtering based on average gene expression levels.
<code>"dispersion"</code> stands for filtering based on gene expression dispersion.
<code>"dropout"</code> stands for filtering based on dropout rates.</p></td>
    </tr>
    <tr>
      <th>strata.filtered</th>
      <td><p>The strata to be filtered out in computing error matrix-related quantities.
Genes falling into these strata will be excluded. See "Details" for more description of gene filtering.</p></td>
    </tr>
    <tr>
      <th>target.by</th>
      <td><p>A string to specify the method to define "biologically important" DE genes.
Available options are (1) <code>"lfc"</code>: interesting genes are defined by absolute log2 fold changes.
(2) <code>"effectsize"</code>: interesting genes are defined by
absolute log2 fold changes divided by the square root of 1/(mean+dispersion).</p></td>
    </tr>
    <tr>
      <th>delta</th>
      <td><p>A threshold used for defining "biologically important" genes.
Genes with absolute log2 fold changes (when target.by is "lfc")
or effect sizes (when target.by is "effectsize") greater than this value
are deemed DE in error rates calculations. If <code>delta=0</code> then no threshold is applied. See "Details" for more description.</p></td>
    </tr>
    <tr>
      <th>Table</th>
      <td><p>A logical vector. If the default <code>TRUE</code>, then a table of marginal error rates is printed additionally (see <code><a href='printEvalDE.html'>printEvalDE</a></code>).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with the following entries:</p>
<dt>TN, TP, FP, FN, TNR, TPR, FPR, FNR, FDR</dt><dd><p>3D array representing the number of true negatives, true positives, false positives,
false negatives and their proportions/rates as well as false discovery rate
for all simulation settings. The dimension of the arrays are nstrata * N * nsims.
Here nstrata is number of specified strata.
N is number of different sample sizes settings, and nsims is number of simulations.</p></dd>
<dt>TN.marginal, TP.marginal, FP.marginal, FN.marginal</dt><dd><p>Matrix representing the number of true negatives, true positives, false positives,
 false negatives for all simulation settings.
 The dimension of the matrices are N * nsims.
 Here N is number of different sample sizes settings, and nsims is number of simulations.</p></dd>
<dt>TNR.marginal, TPR.marginal, FPR.marginal, FNR.marginal, FDR.marginal</dt><dd><p>Matrix representing the marginal rates for all simulation settings.
The dimension of the matrices are N * nsims.</p></dd>
<dt>stratagenes, stratadiffgenes</dt><dd><p>Number of genes per stratum and number of DE genes per stratum.</p></dd>
<dt>stratify.by</dt><dd><p>The input "stratify.by".</p></dd>
<dt>strata</dt><dd><p>The input strata.</p></dd>
<dt>n1,n2</dt><dd><p>Sample sizes per group.
This is taken from the simulation options.</p></dd>
<dt>target.by</dt><dd><p>The input method to define "biologically important" DE genes,
either by log fold change or effect size.</p></dd>
<dt>delta</dt><dd><p>The input delta for biologically important genes.
If delta=0, all target.by will be considered.</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This is the main function to compute various power-related quantities,
using stratification and filtering.</p><dl'>
<dt>Gene stratification</dt><dd><p>We recommend to compute and visualize error rates (especially TPR)
conditional on expression characteristics like mean, dispersion and/or dropout rate.
It is likely that the power to detect DE genes is strongly dependent on
mean expression levels even though the magnitude of effect sizes is the same.
The stratified results will provide a more comprehensive power assessment and
better guide the investigators in experimental designs and analysis strategies.</p></dd>
<dt>Gene filtering</dt><dd><p>Sometimes it is advisible to filter out some genes
(such as the ones with very low mean expression) before DE detection.
The filtering option here provides an opportunity to compare the rates before and after filtering.</p></dd>
<dt>Define biologically interesting genes</dt><dd><p>We provide two options to define biologically interesting genes:
by absolute values of log fold changes or effect sizes
(absolute values of log fold changes divided by the square root of 1/(mean+dispersions)).
Genes with these quantities over a threshold are deemed interesting,
and the rate calculations are based on these genes.</p></dd>

</dl>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='estimateParam.html'>estimateParam</a></code> for negative binomial parameters,
<code><a href='Setup.html'>Setup</a></code> for setting up simulation parameters and
<code><a href='simulateDE.html'>simulateDE</a></code> for simulating differential expression and
<code><a href='plotEvalDE.html'>plotEvalDE</a></code> for visualisation.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># estimate gene parameters</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"Bulk_Read_Counts"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"GeneLengths_hg19"</span>)
<span class='no'>estparam_gene</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='estimateParam.html'>estimateParam</a></span>(<span class='kw'>countData</span> <span class='kw'>=</span> <span class='no'>Bulk_Read_Counts</span>,
                               <span class='kw'>readData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                               <span class='kw'>batchData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                               <span class='kw'>spikeData</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>spikeInfo</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                               <span class='kw'>Lengths</span> <span class='kw'>=</span> <span class='no'>GeneLengths_hg19</span>, <span class='kw'>MeanFragLengths</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                               <span class='kw'>RNAseq</span> <span class='kw'>=</span> <span class='st'>'bulk'</span>, <span class='kw'>Protocol</span> <span class='kw'>=</span> <span class='st'>'Read'</span>,
                               <span class='kw'>Distribution</span> <span class='kw'>=</span> <span class='st'>'NB'</span>, <span class='kw'>Normalisation</span> <span class='kw'>=</span> <span class='st'>"MR"</span>,
                               <span class='kw'>GeneFilter</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>SampleFilter</span> <span class='kw'>=</span> <span class='fl'>3</span>,
                               <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='fl'>1.96</span>, <span class='kw'>NCores</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='co'># define log fold change</span>
<span class='no'>p.lfc</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>1</span>,<span class='fl'>1</span>), <span class='kw'>size</span><span class='kw'>=</span><span class='no'>x</span>,<span class='kw'>replace</span><span class='kw'>=</span><span class='no'>T</span>)*<span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span>(<span class='no'>x</span>, <span class='kw'>shape</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>rate</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='co'># set up simulations</span>
<span class='no'>setupres</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='Setup.html'>Setup</a></span>(<span class='kw'>ngenes</span> <span class='kw'>=</span> <span class='fl'>10000</span>, <span class='kw'>nsims</span> <span class='kw'>=</span> <span class='fl'>10</span>,
                  <span class='kw'>p.DE</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>pLFC</span> <span class='kw'>=</span> <span class='no'>p.lfc</span>,
                  <span class='kw'>n1</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>3</span>,<span class='fl'>6</span>,<span class='fl'>12</span>), <span class='kw'>n2</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>3</span>,<span class='fl'>6</span>,<span class='fl'>12</span>),
                  <span class='kw'>Thinning</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>0.9</span>,<span class='fl'>0.8</span>), <span class='kw'>LibSize</span> <span class='kw'>=</span> <span class='st'>'given'</span>,
                  <span class='kw'>estParamRes</span> <span class='kw'>=</span> <span class='no'>estparam_gene</span>,
                  <span class='kw'>estSpikeRes</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                  <span class='kw'>DropGenes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
                  <span class='kw'>sim.seed</span> <span class='kw'>=</span> <span class='fl'>4379</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='co'># run simulation</span>
<span class='no'>simres</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simulateDE.html'>simulateDE</a></span>(<span class='kw'>SetupRes</span> <span class='kw'>=</span> <span class='no'>setupres</span>,
                     <span class='kw'>Prefilter</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>Imputation</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                     <span class='kw'>Normalisation</span> <span class='kw'>=</span> <span class='st'>'MR'</span>, <span class='kw'>Label</span> <span class='kw'>=</span> <span class='st'>'none'</span>,
                     <span class='kw'>DEmethod</span> <span class='kw'>=</span> <span class='st'>"limma-trend"</span>, <span class='kw'>DEFilter</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
                     <span class='kw'>NCores</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='co'># DE evaluation</span>
<span class='no'>evalderes</span> <span class='kw'>&lt;-</span> <span class='fu'>evaluateDE</span>(<span class='kw'>simRes</span> <span class='kw'>=</span> <span class='no'>simres</span>, <span class='kw'>alpha.type</span><span class='kw'>=</span><span class='st'>"adjusted"</span>,
                        <span class='kw'>MTC</span><span class='kw'>=</span><span class='st'>'BH'</span>, <span class='kw'>alpha.nominal</span><span class='kw'>=</span><span class='fl'>0.05</span>,
                        <span class='kw'>stratify.by</span> <span class='kw'>=</span> <span class='st'>"lfc"</span>, <span class='kw'>filter.by</span> <span class='kw'>=</span> <span class='st'>"mean"</span>,
                        <span class='kw'>strata.filtered</span> <span class='kw'>=</span> <span class='fl'>1</span>,
                        <span class='kw'>target.by</span> <span class='kw'>=</span> <span class='st'>"lfc"</span>, <span class='kw'>delta</span> <span class='kw'>=</span> <span class='fl'>0.25</span>)
<span class='fu'><a href='plotEvalDE.html'>plotEvalDE</a></span>(<span class='kw'>evalRes</span> <span class='kw'>=</span> <span class='no'>evalderes</span>, <span class='kw'>rate</span> <span class='kw'>=</span> <span class='st'>"marginal"</span>)
<span class='fu'><a href='plotEvalDE.html'>plotEvalDE</a></span>(<span class='kw'>evalRes</span> <span class='kw'>=</span> <span class='no'>evalderes</span>, <span class='kw'>rate</span> <span class='kw'>=</span> <span class='st'>"conditional"</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Beate Vieth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


